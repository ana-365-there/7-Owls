<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Snack Inventory System</title>

<style>
body { font-family: Arial; background:#f5f5f5; padding:20px; }
h1, h2 { text-align:center; }
table { width:100%; border-collapse: collapse; margin-top:20px; background:#fff; }
th, td { border:1px solid #ccc; padding:10px; text-align:center; }
th { background:#222; color:#fff; }
input { padding:6px; }
button { padding:8px 14px; cursor:pointer; font-size:14px; margin:3px; }
.section { background:#fff; padding:15px; margin-top:20px; }
.hidden { display:none; }
.delete-btn { background:#e74c3c; color:#fff; border:none; }
</style>
</head>

<body>

<!-- LOGIN -->
<div id="loginBox" class="section">
  <h2>üîê Enter Password</h2>
  <input type="password" id="password">
  <button onclick="login()">Login</button>
</div>

<!-- MAIN APP -->
<div id="app" class="hidden">

<h1>üõí Snack Inventory & Sales</h1>

<div class="section">
  <h3>‚ûï Add / Update Item</h3>
  <input id="newItemName" placeholder="Item Name">
  <input id="newItemQty" type="number" placeholder="Quantity">
  <button onclick="addOrUpdateItem()">Add / Update</button>
</div>

<table id="inventoryTable">
<thead>
<tr>
  <th>Item</th>
  <th>Available</th>
  <th>Sell Qty</th>
  <th>Buyer</th>
  <th>Amount ‚Çπ</th>
  <th>Action</th>
</tr>
</thead>
<tbody></tbody>
<tfoot>
<tr style="font-weight:bold;">
  <td colspan="5">Total Sale (‚Çπ)</td>
  <td id="totalSale">0</td>
</tr>
</tfoot>
</table>

<div style="text-align:center;">
  <button onclick="sellAll()">‚úÖ Sell</button>
  <button onclick="undoSale()">‚Ü©Ô∏è Undo Last Sale</button>
</div>

<div class="section">
<h3>üßæ Purchase Log</h3>
<ul id="purchaseLog"></ul>
</div>

</div>

<script>
const PASSWORD = "snack_attack";

let items = JSON.parse(localStorage.getItem("items")) || [
  {name:"Tedhe Medhe",qty:21},
  {name:"Mad Angles",qty:3}
];

let logs = JSON.parse(localStorage.getItem("logs")) || [];
let totalSale = parseFloat(localStorage.getItem("totalSale")) || 0;

/* üî• SALES HISTORY ONLY */
let saleHistory = JSON.parse(localStorage.getItem("saleHistory")) || [];

function login(){
  if(password.value === PASSWORD){
    loginBox.style.display="none";
    app.classList.remove("hidden");
    renderAll();
  } else alert("Wrong password");
}

function save(){
  localStorage.setItem("items",JSON.stringify(items));
  localStorage.setItem("logs",JSON.stringify(logs));
  localStorage.setItem("totalSale",totalSale);
  localStorage.setItem("saleHistory",JSON.stringify(saleHistory));
}

function renderAll(){
  const body = document.querySelector("#inventoryTable tbody");
  body.innerHTML = "";
  items.forEach((i,idx)=>{
    body.innerHTML += `
    <tr>
      <td>${i.name}</td>
      <td>${i.qty}</td>
      <td><input id="q${idx}" type="number"></td>
      <td><input id="b${idx}"></td>
      <td><input id="a${idx}" type="number"></td>
      <td><button class="delete-btn" onclick="deleteQty(${idx})">Delete Qty</button></td>
    </tr>`;
  });
  totalSaleEl.textContent = totalSale;
  renderLogs();
}

function renderLogs(){
  purchaseLog.innerHTML="";
  logs.forEach(l=>purchaseLog.innerHTML+=`<li>${l}</li>`);
}

/* ‚úÖ SALE */
function sellAll(){
  let saleBatch = [];

  items.forEach((i,idx)=>{
    let q = parseInt(document.getElementById(`q${idx}`).value);
    let b = document.getElementById(`b${idx}`).value;
    let a = parseFloat(document.getElementById(`a${idx}`).value);

    if(q>0 && q<=i.qty){
      i.qty -= q;
      totalSale += a;
      logs.push(`${b} bought ${q} √ó ${i.name} for ‚Çπ${a}`);
      saleBatch.push({index:idx, qty:q, amount:a});
    }
  });

  if(saleBatch.length){
    saleHistory.push(saleBatch);
    save(); renderAll();
  }
}

/* ‚Ü©Ô∏è UNDO SALE ONLY */
function undoSale(){
  if(!saleHistory.length) return alert("No sale to undo");

  let lastSale = saleHistory.pop();

  lastSale.forEach(s=>{
    if(items[s.index]){
      items[s.index].qty += s.qty;
      totalSale -= s.amount;
      logs.pop();
    }
  });

  save(); renderAll();
}

/* INVENTORY MANAGEMENT (PERMANENT) */
function addOrUpdateItem(){
  let name = newItemName.value.trim();
  let qty = parseInt(newItemQty.value);
  if(!name || qty<=0) return alert("Invalid input");

  let found = items.find(i=>i.name.toLowerCase()===name.toLowerCase());
  if(found) found.qty += qty;
  else items.push({name,qty});

  save(); renderAll();
  newItemName.value=""; newItemQty.value="";
}

function deleteQty(idx){
  let item = items[idx];
  let d = parseInt(prompt(`Delete quantity (Available ${item.qty})`));
  if(!d || d<=0 || d>item.qty) return;

  item.qty -= d;
  if(item.qty === 0) items.splice(idx,1);

  save(); renderAll();
}
</script>

</body>
</html>
